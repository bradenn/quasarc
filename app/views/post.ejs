<!DOCTYPE html>
<html lang="en">
<%- include("partials/header.ejs"); %>
<%- include("partials/nav.ejs"); %>

<body>
  <br>
  <div class="container">
    <div class="row">
      <div class="col-lg-3">
        <%- include("partials/usertab"); %>
      </div>
      <div class="col-lg-6">
        <div class="card">
          <h6 class="card-title-span"><span style="font-size: 90%;"><i class="far fa-comment-alt"></i>&nbsp;<%= post.title %></span><span class="float-right" style="margin-right:16px;">
              <% if(post.nsfw != null && post.nsfw){ %>
              <span class="badge badge-danger nsfw-badge-show">NSFW</span>
              <% } %>
            </span>
            <span class="text-muted float-right" style="margin-right:0.75em;">
              <small><%= timeSince(new Date(post.date)); %> ago</small>
            </span>
          </h6>
          <div style="margin-left: 16px;">
            <span class="card-sub-span">
              <a href="/r/<%= post.realm.name %>" class="no-bs bold">
                r/<%= post.realm.name %>
              </a>&bull; posted by
              <a href="/u/<%= post.user.username %>" class="no-bs">
                u/<%= post.user.username %>
              </a>
            </span>
          </div>
          <hr>
          <div class="card-body" style="">
            <p class="card-text"><%= post.post %></p>
          </div>
          <hr>
          <span style=" margin-left: 16px; ">
            <ul class="list-inline" style="margin-bottom:0px;">
              <li class="list-inline-item">
                <a class="post-items" href="#share">
                  <% if(post.comments.length === 0){ %> No Comments<% }%>
                  <% if(post.comments.length === 1){ %><%= post.comments.length %> Comment<% }%>
                  <% if(post.comments.length >= 2){ %><%= post.comments.length %> Comments<% }%>
                </a>
              </li>
              <li class="list-inline-item">
                <a class="post-items" href="#share">Share</a>
              </li>
              <li class="list-inline-item">
                <a class="post-items" href="#report">Report</a>
              </li>
              <% if(user != null && post.user._id.toString() === user._id.toString()){ %>
                <li class="list-inline-item">
                  <a class="post-items" href="/p/remove/<%= post._id %>">Delete</a>
                </li>
              <% } %>
            </ul>
          </span>
          <hr>
          <% if(user != null){ %>
          <form id="post" action="/p/<%= post._id %>" class="" style="margin-left:16px; margin-right:16px;" method="post">
            <small>Comment as <a href="/profile"><%= user.username %></a></small>
            <div class="form-group">
              <textarea class="form-control" type="text" id="body" name="body"></textarea>
            </div>

          </form>
          <% }else{ %>
          <p style="margin-left:16px;"><a href="/login">Login to comment.</a></p>
          <% } %>
          <hr>
          <% for (var i = 0; i < post.comments.length; i++) { %>
          <div class="comment-body">
            <a href="/u/<%= post.comments[i].author %>" class="comment-header">u/<%= post.comments[i].author %></a>&nbsp;â€¢&nbsp;<span><%= timeSince(new Date(post.date)); %> ago</span><br>
            <span><%= post.comments[i].body %></span>
          </div>
          <% } %>
          <% if(post.comments.length <= 0){ %>
          <div class="comment-body">
            <span>No Comments</span>
          </div>
          <% } %>
        </div>

      </div>
      <div class="col-lg-3">
        <%- include("partials/friends"); %>
        <%- include("partials/footer"); %>

      </div>
    </div>
  </div>

</body>
<%

function timeSince(date) {

  var seconds = Math.floor((new Date() - date) / 1000);

  var interval = Math.floor(seconds / 31536000);

  if (interval > 1) {
    return interval + " years";
  }
  interval = Math.floor(seconds / 2592000);
  if (interval > 1) {
    return interval + " months";
  }
  interval = Math.floor(seconds / 86400);
  if (interval > 1) {
    return interval + " days";
  }
  interval = Math.floor(seconds / 3600);
  if (interval > 1) {
    return interval + " hours";
  }
  interval = Math.floor(seconds / 60);
  if (interval > 1) {
    return interval + " minutes";
  }
  return Math.floor(seconds) + " seconds";
}
var aDay = 24*60*60*1000
%>

</html>
